> (= namespace-load-type* 'inherit)
inherit


;=============================================================================
;  Inheritance
;=============================================================================

> (= foo (new-namespace (new-namespace (new-namespace)) (new-namespace)))
#<namespace (len 4)>

> foo!bar
nil

> (= foo!bar 10)
10

> foo!bar
10

> foo!qux
nil


> (eval-w/ (new-namespace) foo)
error: undefined variable: foo


> (= bar (new-namespace namespace))
#<namespace (len 2)>

> (eval-w/ bar foo)
#<namespace (len 4)>

> (eval-w/ bar (= foo 10))
10

> (eval-w/ bar foo)
10

> foo
#<namespace (len 4)>


> (= foo (new-namespace namespace))
#<namespace (len 2)>

> (= bar (new-namespace foo))
#<namespace (len 3)>

> (eval-w/ foo
    (def foo (x)
      (bar x))
    (def bar (x)
      x))
#<fn:bar>

> (eval-w/ bar
    (foo 50))
50

> (eval-w/ bar
    (def bar (x)
      10)
    (foo 50))
50

> (eval-w/ foo
    (dynamic bar bar))
#<fn:bar>

> (eval-w/ bar
    (foo 50))
10

> (eval-w/ foo
    (foo 50))
50


;=============================================================================
;  Dynamic variables
;=============================================================================

> (dynamic dyn-foo 5)
5

> dyn-foo
5

> (ac-compile 'dyn-foo)
(#<fn:ac-lookup-global-arg> (#<fn:ac-lookup-global-raw> #<namespace:0> (racket-quote dyn-foo)))

> (eval 'dyn-foo)
5

> (= dyn-foo 10)
10

> dyn-foo
10


;=============================================================================
;  Implicit namespace creation
;=============================================================================

> (= old-load-type* namespace-load-type*)

> (= namespace-load-type* 'inherit)
inherit


> (def nou ())
#<fn:nou>

> namespace
#<namespace:0>

> (def nou ())
*** redefining nou
#<fn:nou>

> namespace
#<namespace:0>

> (import time)
 loading:  time.arc
 skipping: strings.arc
nil

> (import time)
 skipping: time.arc
nil

> namespace
#<namespace:0>

> (reimport time)
 loading:  time.arc
 loading:  strings.arc
*** creating new namespace to avoid redefining tokens
nil

> namespace
#<namespace (len 2)>


> (= namespace-load-type* old-load-type*)


;=============================================================================
;  Namespace reversal
;=============================================================================

> (= arc    (new-namespace arc3-namespace))
#<namespace (len 2)>

> (= arubic (new-namespace arc))
#<namespace (len 3)>


> (eval-w/ arc
    (def qux (x)
      10)
    (def nou (x)
      29))
#<fn:nou>

> (eval-w/ arubic
    (def qux (x)
      x)
    (def corge (x)
      (+ (qux x) (nou x))))
#<fn:corge>


> (eval-w/ arc
    (qux 50))
10

> (eval-w/ arubic
    (qux 50))
50

> (eval-w/ arc
    (corge 50))
error: undefined variable: corge

> (eval-w/ arubic
    (corge 50))
79


> (zap namespace-fn arubic rev)
#<namespace (len 3)>


> (eval-w/ arc
    (qux 50))
10

> (eval-w/ arubic
    (qux 50))
10

> (eval-w/ arc
    (corge 50))
error: undefined variable: corge

> (eval-w/ arubic
    (corge 50))
79


;=============================================================================
;  Namespace copying
;=============================================================================

> (= old-namespace namespace)

> (is namespace old-namespace)
t

> (is arc3-namespace (racket-current-namespace))
t


> (= namespace (w/namespace-load-type* 'copy (new-namespace namespace)))
#<namespace:0>

> (is namespace (racket-current-namespace))
t

> (is arc3-namespace (racket-current-namespace))
nil

> (is namespace old-namespace)
nil


> (= namespace old-namespace)

> (is namespace old-namespace)
t

> (is namespace (racket-current-namespace))
nil

> (is arc3-namespace (racket-current-namespace))
t


> (= foo (w/namespace-load-type* 'copy (new-namespace arc3-namespace)))
#<namespace:0>

> (eval-w/ foo
    (def qux ()
      10)
    (def corge ()
      (qux)))
#<fn:corge>


> (= bar (w/namespace-load-type* 'copy (new-namespace foo)))
#<namespace:0>

> (eval-w/ bar
    (def qux ()
      50)
    (corge))
*** redefining qux
10

> (eval-w/ bar
    (qux))
50


> (eval-w/ foo
    (qux))
10

> (eval-w/ foo
    (corge))
10


> (eval-w/ foo
    (nou))
error: undefined variable: nou

> (eval-w/ bar
    (nou))
error: undefined variable: nou


> (eval-w/ foo
    (def nou ()
      76))
#<fn:nou>

> (eval-w/ foo
    (nou))
76

> (eval-w/ bar
    (nou))
error: undefined variable: nou


;=============================================================================
;  Hygienic macros
;=============================================================================

> (= arc    (new-namespace arc3-namespace))
#<namespace (len 2)>

> (= arubic (new-namespace arc))
#<namespace (len 3)>


> (eval-w/ arc
    (def bar ()
      10)
    (mac qux ()
      `(bar))
    (qux))
10

> (eval-w/ arubic
    (def bar ()
      20)
    (qux))
20


> (eval-w/ arc
    (mac qux ()
      `(,bar)))
*** redefining qux
#<mac:qux>

> (eval-w/ arc
    (qux))
10

> (eval-w/ arubic
    (qux))
10
