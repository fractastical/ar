#! /usr/bin/env arc

(load "lib/tester.arc")
(load "lib/parse-script-args.arc")

(mac extend (name arglist test . body)
  (w/uniq args
    `(let orig ,name
       (= ,name
          (fn ,args
            (aif (apply (fn ,arglist ,test) ,args)
                  (apply (fn ,arglist ,@body) ,args)
                  (apply orig ,args)))))))

(= verbose nil)

(parse-script-args
  ("-v" "--verbose" (= verbose t)))

(each x script-args
  (test-file x))

(unless script-args
  (w/curdir "tests"
    ;(system "set -e -v")
    (system "mzscheme ar-test.ss")
    (system "mzscheme ac-test.ss")

    (test-files "apply"
                "arc"
                "assign"
                "coerce"
                "fn"
                "if"
                "io.arc"
                "Paths"
                "quasiquote"
                "quote"
                ;"re" ; our re support is too broken right now, enable later
                "strings.arc"
                "(coerce foo 'fn)"))

  (system "sudo ./arc run-tests \"tests/io.arc (root)\""))
